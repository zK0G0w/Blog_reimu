---
title: 'Network'

date: '2025-03-14T09:57:58+08:00'
lastmod: '2025-03-14T09:57:58+08:00'

categories: ["网络"]
tags: ["网络"]
description: 目前卧室的网络架构
---

# PVE 虚拟化环境网络架构

## 一、物理架构概览

```plaintext
外网
  │
  ▼
[光猫/上级路由] (192.168.31.1)
  │
  ▼
[PVE物理机]
  │
  ├─── [eth0] ◄──► [vmbr0] (虚拟交换机)
  │                    │
  │                    ├────► [PVE管理界面]
  │                    │
  │                    ├────► [VM1]
  │                    │
  │                    ├────► [VM2]
  │                    │
  │                    ├────► [VM3]
  │                    │
  │                    └────► [iKuai VM]
  │                            │
  │                            ▼
  └─── [eth1] ═══直通═══► [iKuai LAN口]
                              │
                              ▼
                            [AP]
                              │
                              ▼
                        [终端设备]

```

## 二、网络组件说明

### 2.1 物理设备
1. **光猫/上级路由**
   - IP地址：192.168.31.1
   - 功能：提供外网连接
   - 角色：网络出口

2. **PVE物理机**
   - eth0：连接光猫，作为 WAN 口
   - eth1：直通给 iKuai，作为 LAN 口
   - vmbr0：PVE 虚拟交换机

3. **AP设备**
   - 连接方式：连接到 eth1（iKuai LAN口）
   - 功能：提供无线网络接入

### 2.2 虚拟组件
1. **vmbr0（虚拟交换机）**
   - 功能：连接所有虚拟机
   - 特点：类似物理交换机
   - 连接：eth0 和所有虚拟机

2. **iKuai 软路由（虚拟机）**
   - WAN口：通过 vmbr0 连接
   - LAN口：直通物理网卡 eth1
   - 功能：
     - 网络路由
     - DHCP服务
     - 防火墙
     - 流量控制
     - 网络监控

3. **其他虚拟机**
   - 网络接入：通过 vmbr0 连接
   - 默认网关：指向 iKuai
   - 网络模式：桥接

## 三、数据流向分析

### 3.1 虚拟机访问外网
```plaintext
[虚拟机] → vmbr0 → iKuai → vmbr0 → eth0 → 光猫 → 互联网
```

### 3.2 AP设备访问外网
```plaintext
[终端设备] → AP → eth1 → iKuai → vmbr0 → eth0 → 光猫 → 互联网
```

### 3.3 内网设备互访
```plaintext
虚拟机之间：
[VM1] → vmbr0 → iKuai → vmbr0 → [VM2]

AP设备访问虚拟机：
[终端设备] → AP → eth1 → iKuai → vmbr0 → [目标VM]
```

## 四、网段规划

### 4.1 主要网段
1. **WAN口网段**
   - 网段：192.168.31.x
   - 网关：192.168.31.1（光猫）

2. **虚拟机网段**
   - 网段：192.168.1.x
   - 网关：192.168.1.1（iKuai）

3. **AP设备网段**
   - 网段：192.168.2.x
   - 网关：192.168.2.1（iKuai）

## 五、网络特点

1. **集中管理**
   - iKuai作为核心，统一管理所有网络流量
   - 可实现细粒度的访问控制
   - 支持流量监控和限速

2. **网络隔离**
   - 虚拟机网段与AP设备网段相互隔离
   - 可通过iKuai设置访问规则

3. **灵活扩展**
   - 可以方便地添加新的虚拟机
   - 支持多个AP设备接入
   - 网段可根据需求调整

## 六、维护建议

1. **日常检查**
   - 定期检查 iKuai 日志
   - 监控网络流量情况
   - 检查设备连接状态

2. **安全配置**
   - 及时更新 iKuai 系统
   - 定期检查防火墙规则
   - 确保网络隔离有效

3. **备份策略**
   - 定期备份 iKuai 配置
   - 记录网络变更
   - 保存重要配置文档

---
*注：此文档记录了当前网络架构，后续根据实际需求进行调整和优化。定期更新，以反映最新的网络状态。*